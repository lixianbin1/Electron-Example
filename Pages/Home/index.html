<div style="margin:10px 20px;">
    <div class="_layui-row">
        <div class="search">
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="bookName" placeholder="书名" class="layui-input">
            </div>
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="author" placeholder="作者" class="layui-input">
            </div>
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="press" placeholder="出版社" class="layui-input">
            </div>
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="ext" placeholder="扩展名" class="layui-input">
            </div>
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="language" placeholder="语言" class="layui-input">
            </div>
            <div class="layui-col-xs12 layui-col-sm4">
                <input type="text" name="isbn" placeholder="ISBN" class="layui-input">
            </div>
        </div>
        <div class="_layui-list">
            <table class="layui-hide" id="ID-table-demo-data"></table>
        </div>
    
        <div id="demo-laypage-normal-2"></div>
    </div>
</div>

<script type="text/html" id="barDemo">
    <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs down" lay-event="down">下载
            <i class="layui-icon layui-icon-down"></i>
        </a>
    </div>
</script> 

<script>

layui.use(function(){

  //设置分页
  const setCount=(num=10)=>{
    var laypage = layui.laypage;
    laypage.render({
        elem: 'demo-laypage-normal-2',
        limit: 20,
        count: num
    });
  }
  setCount()

  //设置table
  const setTable=(data=[])=>{
    console.log($(window).innerWidth())
    var table = layui.table;
    var inst = table.render({
        elem: '#ID-table-demo-data',
        cols: [[ //标题栏
            // {field: 'id', title: 'ID', width: 80, sort: true},
            {field: 'title', title: '书名', minWidth: 180},
            {field: 'author', title: '作者', minWidth: 150},
            {field: 'publisher', title: '出版社', minWidth: 150},
            {field: 'year', title: '时间', minWidth: 80, sort: true},
            {field: 'extension', title: '扩展名', minWidth: 80},
            {field: 'filesize', title: '大小', minWidth: 80, sort: true},
            {field: 'language', title: '语言', minWidth: 80,},
            {fixed: 'right', title:'操作', width: 80, toolbar: '#barDemo'}
        ]],
        data: data,
        //skin: 'line', // 表格风格
        //even: true,
        page: false,
    });

    // 下载事件
    table.on('tool(ID-table-demo-data)', function(obj){
        var data = obj.data; // 获得当前行数据
        if(obj.event === 'down'){
            let url = 'https://gateway.pinata.cloud/ipfs/' + data.ipfs_cid + '?filename=' + data.title+"."+data.extension
            console.log('下载')
            downFile.file(url,data.title+"."+data.extension)
        }
    })
  }

  $("input[name='bookName']").blur((e)=>{
        let val = e.target.value
        if(val){
            $.ajax('https://zbook.lol/search', {
                method: 'GET',
                data: {
                    title: val,
                    limit: 20,
                    offset:0
                },
                success:function (result) {
                    setCount(result.total)
                    setTable(result.books)
                    console.log(result);
                },
                error:function (err) {
                    console.log(err);
                }
            })

        }
    })




});

</script>

<style>
._card-box{
    width: 200px;
    border: 1px solid #ccc;
    height: 200px;
    border-radius: 10px;
    justify-content: center;
    align-items: center;
    display: inline-flex;
    margin: 5px;
}
._card-box>i{
    font-size: 20px;
}
._layui-row{
    margin: 0 -5px;
}
.search{overflow: hidden;}
.search>div{
    padding: 5px;
}
._layui-row .grid-demo{
    border: 1px solid #ccc;
    box-sizing: border-box;
    border-radius: 10px;
    height: 200px;
}
._layui-list{
    height: calc(100% - 160px);
    padding: 0 5px;
}
.layui-laypage{
    margin: 0;
    overflow: hidden;
}
#demo-laypage-normal-2{
    position: absolute;
    bottom: 5px;
    left: 10px;
}
.layui-table-body{
    height: calc(100% - 40px);
}
@media screen and (max-width: 768px) {
    ._layui-list{
        height: calc(100% - 345px);
    }
    /* .layui-table-body{
        height: calc(100% - 45px);
    } */
}
</style>